<!DOCTYPE html>
<!--[if lt IE 8 ]>
<html class="no-js ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]>
<html class="no-js ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 8)|!(IE)]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->

<head>
    <!--- basic page needs -->
    <meta charset="utf-8">
    <title>travelapp</title>
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- mobile specific metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <!-- css -->
    <link rel="stylesheet" href="css/default.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="stylesheet" href="css/animate.css">
    <link href="css/prism.css" rel="stylesheet">
    <!-- script -->
    <script src="js/modernizr.js"></script>
    <!-- favicons -->
    <link rel="shortcut icon" href="images/qacg.ico">
</head>

<body>
<!-- preloader -->
<div id="preloader">
    <div class="loader"></div>
</div>
<!--preloader end-->
<!-- header section -->
<header id="home">
    <nav id="m-nav">
        <a class="mobile-btn" href="#m-nav" title="Show navigation">Show navigation</a>
        <a class="mobile-btn" href="#" title="Hide navigation">Hide navigation</a>
        <ul id="nav" class="nav">
            <li><a href="index.html">Inicio</a></li>
            <li><a href="index.html#agenda">Temario</a></li>
            <li><a href="session-one.html">Sesi贸n # 1</a></li>
            <li><a href="session-two.html">Sesi贸n # 2</a></li>
            <li class="current"><a class="smoothscroll" href="#">Sesi贸n # 3</a></li>
            <li><a href="session-four.html">Sesi贸n # 4</a></li>
        </ul>
    </nav>
    <div class="row banner">
        <div class="banner-text">
            <h1 class="responsive-headline wow zoomIn">Integraci贸n de librer铆as</h1>
            <h3 class="wow fadeInUp">
                Sesi贸n # 3
                <br>
                <br>
                Quality & Knowledge on IT Services
                <br>
                <span style="font-size: .7em;">( contenido disponible el s谩bado 24 de Noviembre del 2018)</span>
            </h3>
        </div>
    </div>
    <p class="scrolldown">
        <a class="smoothscroll" href="#about"><i class="fa fa-angle-double-down"></i></a>
    </p>
    <div class="header-overlay"></div>
</header>
<!-- header end -->
<!-- section start -->
<section id="agenda">
    <!-- Start Main libraries -->
    <h1 class="section-title wow fadeInDown">Librer铆as Android</h1>
    <div class="row education">
        <p>A continuaci贸n se listan las librer铆as, que comunmente se utilizan durante el desarrollo de una aplicaci贸n
            Android.<br/>
            <span><a href="https://square.github.io/retrofit/">Retrofit</a> - </span>Se describe a si mismo de la siguiente manera,
            "Convierte una REST API a una interfaz Java", permite a trav茅z de anotaciones agregar un cuerpo en la petici贸n,
            manipular los parametros de la URL y encabezados de la petici贸n.<br/>
            <span><a href="https://github.com/google/gson">Gson</a> - </span>Se utiliza para la serializaci贸n y
            deserializacion de objetos Java a JSON y al rev茅s ( de JSON a objetos Java).<br/>
            <span><a href="https://bumptech.github.io/glide/">Glide</a> - </span>Librer铆a utilizada para descargar im谩genes desde una URL.<br/>
            <span><a href="https://github.com/dlew/joda-time-android">JodaTime</a> - </span>Libreria que facilita enormemente el manejo de fechas, parseo, formato, etc.<br/>
            <span><a href="https://github.com/ocpsoft/prettytime">Prettytime</a> - </span>Formato de fechas para Java con un formato de redes sociales.<br/>
            <span><a href="https://realm.io/docs/java/latest">Realm</a> - </span>Es un motor de bases de datos local utilizada en Android.<br/>
            <span><a href="https://developers.google.com/maps/documentation/android-sdk/intro"></a>Google Maps - </span>Integraci贸n con mapas de Google.<br/>
        </p>
    </div>
    <!-- start libraries types -->
    <h1 class="section-title wow fadeInDown">Tipos de librer铆as</h1>
    <div class="row education">
        <p>Podemos encontrar dos formas de agregar librer铆as a nuestra aplicaci贸n:<br/>
            <span>Localmente - </span>Los archivos de la libreria deben ser
            descargados para poder incluirlas en la aplicaci贸n.<br/>
            <span>Remotas - </span>Se agregan como una dependencia de Gradle para
            que al momento de realizar la sincronizacion, Gradle descargue las dependencias correspondientes en el proyecto.<br/>
        </p>
    </div>
    <!-- end libraries types -->
    <!-- start Retrofit authentication -->
    <div class="header-col content-header">
        <h2><span>Retrofit y Gson - Autenticaci贸n de usuarios</span></h2>
    </div>
    <div class="row education">
        <p>
            Vamos a integrar las librer铆as Retrofit y Gson para poder sustituir la autenticaci贸n "dummy" por
            una autenticaci贸n remota.<br />
            Para esto, ser谩 necesario consumir el siguiente servicio web: <br />
            <pre><code>https://travelapp-api.herokuapp.com/api/user/autenticate</code><br/></pre><br />
            El cual recibe y devuelve los siguientes datos en formato JSON a trav茅s de una peticion POST.
        </p>
        <pre><code class="language-javascript">
            <script type="prism-javascript">
// Cuerpo de la petici贸n
{
  "username": "USER",
  "password": "PASSWORD"
}

// Respuesta
{
    "_id": "ID_USUARIO",
    "username": "USER",
    "password": "PASSWORD",
    "role": "ROLE"
}</script>
        </code>
        </pre>
        <br />
        <ol>
            <li>
                <span><p>Configurando Retrofit</p></span>
                <ol>
                    <li>
                        <p>Agregar las siguientes dependencias en el archivo Gradle de <span>la aplicaci贸n.</span></p>
                        <pre><code>implementation 'com.squareup.retrofit2:retrofit:2.5.0'</code></pre>
                        <pre><code>implementation 'com.squareup.retrofit2:converter-gson:2.5.0'</code><br/></pre><br />
                        
                        <div class="content-picture-container">
                            <img class="content-picture wow zoomIn" src="images/session-three/gradle-dependencies.png" alt="new project" />
                        </div>
                    </li>
                    <li>
                        <p><span>Sincronizar el script gradle para descargar las dependencias agregadas.</span></p>
                    </li>
                    <li>
                        <p>
                            Crear el paquete <span>api</span> dentro del paquete <span>travelapp</span>.
                        </p>
                        <div class="content-picture-container">
                            <img class="content-picture wow zoomIn" src="images/session-three/api-package.png " alt="new project" />
                        </div>
                    </li>
                    <li>
                        <p>Archivo de servicios</p>
                        <p>Crear el archivo <span>ITravelResource.java</span> en el paquete <span>api</span>, esta ser谩 la interfaz donde se van a declarar los servicios web.</p>
                    </li>
                    <li>
                        <p>Inicializacion de Retrofit.</p>
                        <p>Crearemos el objeto <span>retrofit</span>, utilizando el patron singleton, para ello, creamos el archivo <span>ResourceGenerator.java</span> en el paquete <span>api</span> y agregar el contenido de configuraci贸n.</p>
                        <pre><code class="language-java">
                        <script type="prism-java">
package com.qacg.travelapp.api;

import retrofit2.Retrofit;
import retrofit2.converter.gson.GsonConverterFactory;

public class ResourceGenerator {

    /**
     * Url base de los servicios de la aplicaci贸n.
     */
    private static final String BASE_URL = "https://travelapp-api.herokuapp.com/api/";

    private static ITravelResource travelResource;

    private ResourceGenerator() {}

    static {
        setupRetrofit();
    }

    private static void setupRetrofit() {
        Retrofit retrofit = new Retrofit.Builder()
                .addConverterFactory(GsonConverterFactory.create())
                .baseUrl(BASE_URL).build();
        travelResource = retrofit.create(ITravelResource.class);
    }

    public static ITravelResource getTravelResource() {
        return travelResource;
    }
}</script>
                    </code>
                    </pre>
                    </li>
                </ol>
            </li>
            <li>
                <span><p>Integrando la autenticaci贸n de usuario</p></span>
                <ol>
                    <li>
                        <p>Configurando nuestro servicio web de autenticaci贸n</p>
                        <p>Agregamos el m茅todo <span>authenticateUser</span> en la interfaz <span>ITravelResource.java</span>, nuestro archivo quedar谩 de la siguiente forma:</p>
                        <pre><code class="language-java">
                        <script type="prism-java">
package com.qacg.travelapp.api;

import com.qacg.travelapp.models.User;

import retrofit2.Call;
import retrofit2.http.Body;
import retrofit2.http.POST;

public interface ITravelResource {

    @POST("user/autenticate")
    Call<User> authenticateUser(@Body Object body);

}</script>
                    </code>
                    </pre>
                    </li>
                    <li>
                        <p>Permisos de acceso a internet</p>
                        <p>Agregamos el permiso para acceso a internet de la aplicaci贸n en el archivo <span>AndroidManifest.xml</span>:</p>

<pre><code class="language-java"><script type="prism-java"><uses-permission android:name="android.permission.INTERNET"/></script></code></pre>

                        <div class="content-picture-container">
                            <img class="content-picture wow zoomIn"  src="images/session-three/internet-permissions.png" alt="new project" />
                        </div>
                    </li>
                    <li>
                        <p>Preparando nuestro modelo de Peticion/Respuesta</p>
                        <p>Realizaremos unas peque帽as modificaciones a nuestra clase <span>User.java</span>, para poder
                            serializar y deserializar correctamente los datos que se envian y reciben del servidor.</p>
                        <ol>
                            <li><p>Agregamos una anotaci贸n para la serializacion de objetos para el campo <span>userName</span>, esto
                            nos permite recibir y enviar correctamente el nombre del campo <span>username</span> al momento de
                            serializar/deserializar la clase <span>User.java</span></p></li>
                            <li><p>Agregamos un constructor que recibe como argumentos el usuario y password.</p>
                                <pre><code class="language-java">
                        <script type="prism-java">
package com.qacg.travelapp.models;

import com.google.gson.annotations.SerializedName;

/**
 * Modelo que representa al usuario de la aplicaci贸n.
 */
public class User {

    @SerializedName("username")
    private String userName;
    private String password;

    public User(String userName, String password) {
        this.userName = userName;
        this.password = password;
    }

    public String getUserName() {
        return userName;
    }

    public void setUserName(String userName) {
        this.userName = userName;
    }

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }
}</script></code></pre>
                            </li>
                        </ol>
                    </li>

                    <li><p>Agregamos m茅todos para manejo de error(es) de red.</p>
                        <ol>
                            <li>
                                <p>Agregamos el m茅todo <span>connectionUnavailable</span> en el archivo <span>ILoginView.java</span>.</p>
                                <pre><code class="language-java">
                        <script type="prism-java">
package com.qacg.travelapp.views;

import com.qacg.travelapp.models.User;

/**
 * Vista que define el comportamiento de la vista.
 */
public interface ILoginView {
    void userFound(User user);

    void userNotFound();

    void emptyFields();

    void connectionUnavailable();
}</script></code></pre>
                            </li>
                            <li>
                                <p>Implementamos el m茅todo <span>connectionUnavailable</span> en la clase <span>LoginActivity.java</span>.</p>
                                <pre><code class="language-java">
                        <script type="prism-java">
@Override
public void connectionUnavailable() {
    final AlertDialog.Builder builder = new AlertDialog.Builder(this, R.style.LightDialogTheme);
    builder.setTitle(R.string.app_name);
    builder.setMessage(R.string.conection_unavailable);
    builder.setPositiveButton(R.string.accept_bnt, new DialogInterface.OnClickListener() {
        public void onClick(DialogInterface dialog, int id) {
            dialog.dismiss();
        }
    });
    AlertDialog dialog = builder.create();
    dialog.show();
}</script></code></pre>
                            </li>
                            <li><p>Agregamos el siguiente string en el archivo de strings.</p>
                                <p>strings.xml</p>
                                <pre><code class="language-java"><script type="prism-java">
<string name="conection_unavailable">Se presentaron algunos problemas al intentar conectarse con los servicios.</string>
</script></code></pre>

                                <p>strings.xml (en)</p>
                                <pre><code class="language-java"><script type="prism-java">
<string name="conection_unavailable">There were some problems when trying to connect with services.</string>
</script></code></pre>
                            </li>
                        </ol>
                    </li>

                    <li>
                        <p>Invocaci贸n del servicio web</p>
                        <p>Modificaremos a nuestro presentador para consumir el servicio web de autenticaci贸n.</p>
                        <pre><code class="language-java">
                        <script type="prism-java">
package com.qacg.travelapp.presents;

import com.qacg.travelapp.api.ResourceGenerator;
import com.qacg.travelapp.models.User;
import com.qacg.travelapp.views.ILoginView;

import retrofit2.Call;
import retrofit2.Callback;
import retrofit2.Response;

public class LoginPresenter {

    private ILoginView view;

    public LoginPresenter(ILoginView view) {
        this.view = view;
    }

    public void validateUser(final String username, String password) {
        if (username.length() == 0 || password.length() == 0) {
            view.emptyFields();
        } else {
            // Creamos nuestro objeto Call
            Call<User> call = ResourceGenerator.getTravelResource().authenticateUser(new User(username, password));
            // Realizamos la invocaci贸n al servicio web en una llamada asincrona.
            call.enqueue(new Callback<User>() {
                @Override
                public void onResponse(Call<User> call, Response<User> response) {
                    if (response.isSuccessful()) {
                        view.userFound(response.body());
                    } else {
                        controlErrors(response.code());
                    }
                }

                @Override
                public void onFailure(Call<User> call, Throwable t) {
                    if (!call.isCanceled()) {
                        view.connectionUnavailable();
                    }
                }
            });
        }
    }

    // Manejamos los codigos de error retornados por el servidor.
    private void controlErrors(int code) {
        if (code == 401) {
            view.userNotFound();
        } else {
            view.connectionUnavailable();
        }
    }
}

                        </script></code></pre>
                    </li>
                </ol>
            </li>
        </ol>
    </div>
    <!-- end Retrofit authentication -->
    <!-- start Retrofit places -->
    <div class="header-col content-header">
        <h2><span>Retrofit - Listado de lugares</span></h2>
    </div>
    <div class="row education">
        <p>
            Integraremos el servicio web que devuelve el listado de lugares que son mostrados en la pantalla principal de la aplicaci贸n.
        Para ello se invocar谩 el siguiente servicio web.
        </p>
        <pre><code>GET -> https://travelapp-api.herokuapp.com/api/place/all</code><br/></pre><br />
        <p>El cual retorna un modelo de respuesta como la siguiente.</p>
        <pre><code class="language-javascript"><script type="prism-javascript">
[
    {
        "postedBy": {
            "urlImageProfile": "https://randomuser.me/api/portraits/men/14.jpg",
            "nameProfile": "Enrique Johnson"
        },
        "placeId": "5bf79980a757cc00165dca6e",
        "createdAt": "2018-11-23T06:08:23.482Z",
        "updatedAt": "2018-11-23T06:08:23.482Z",
        "_id": "5bf79980a757cc00165dca6f",
        "isFavorite": "true",
        "urlImagePlace": "https://www.mercadoeeventos.com.br/wp-content/uploads/2017/12/shutterstock_528411958-1.jpg",
        "latitude": 20.6274,
        "longitude": -87.07987,
        "likes": 78,
        "namePlace": "Playa del carmen",
        "description": "Es una de las playas preferidas para vacacionar en la Riviera Maya, disfrutando su  fina y blanca arena bajo aguas verde-azules.",
        "totalComments": 14,
        "__v": 0
    },
    {
        "postedBy": {
            "urlImageProfile": "https://randomuser.me/api/portraits/women/67.jpg",
            "nameProfile": "Sherri Shaw"
        },
        "placeId": "5bf79980a757cc00165dca70",
        "createdAt": "2018-11-23T06:08:23.482Z",
        "updatedAt": "2018-11-23T06:08:23.482Z",
        "_id": "5bf79980a757cc00165dca71",
        "isFavorite": "false",
        "urlImagePlace": "https://www.mexicodesconocido.com.mx/wp-content/uploads/2016/12/nevado-de-toluca-parque-1600.jpg",
        "latitude": 19.17861,
        "longitude": -99.82111,
        "likes": 50,
        "namePlace": "Nevado de Toluca",
        "description": "Volc谩n mexicano ubicado en el Estado de M茅xico, entre los valles de Toluca y Tenango.",
        "totalComments": 30,
        "__v": 0
    }
]
        </script></code></pre>
        <ol>
            <li>
                <p>Configurando el servicio web</p>
                <p>Agregaremos la configuraci贸n del servicio web de lugares en el archivo <span>ITravelResource.java</span></p>
                <pre><code class="language-java"><script type="prism-java">
    @GET("place/all")
    Call<List<Place>> getAllPlaces();
</script>
</code></pre>
            </li>
            <li>
                <p>Modificando el modelo</p>
                <p>Realizaremos las siguientes modificaciones al modelo para asegurar la correcta serializaci贸n de datos.</p>
                <pre><code class="language-java"><script type="prism-java">
package com.qacg.travelapp.models;

import com.google.gson.annotations.SerializedName;

public class Place {

    @SerializedName("postedBy")
    private Profile profile;
    @SerializedName("createdAt")
    private String date;
    private String urlImagePlace;
    private boolean isFavorite;
    private double latitude, longitude;
    @SerializedName("likes")
    private int totalLikes;
    private String namePlace;
    private String description;
    private int totalComments;

    // getters & setters
    // ...
}</script>
</code></pre>
            </li>
            <li>
                <p>Declaracion del handler de error(es) de conexi贸n</p>
                <p>Agregamos el medodo <span>void connectionUnavailable();</span> en el archivo <span>IPlacesView.java</span></p>
                <pre><code class="language-java"><script type="prism-java">
package com.qacg.travelapp.views;

import com.qacg.travelapp.models.Place;

import java.util.List;

public interface IPlacesView {

    void placesFound(List<Place> places);

    void placesNotFound();

    void connectionUnavailable();

}</script>
</code></pre>
            </li>

            <li>
                <p>Implementamos el handler de errores en el fragmento <span>PlacesFragment.java</span></p>
                <pre><code class="language-java"><script type="prism-java">
    @Override
    public void connectionUnavailable() {
        final AlertDialog.Builder builder = new AlertDialog.Builder(getActivity().getApplicationContext(), R.style.LightDialogTheme);
        builder.setTitle(R.string.app_name);
        builder.setMessage(R.string.conection_unavailable);
        builder.setPositiveButton(R.string.accept_bnt, new DialogInterface.OnClickListener() {
            public void onClick(DialogInterface dialog, int id) {
                dialog.dismiss();
            }
        });
        AlertDialog dialog = builder.create();
        dialog.show();
    }
</script>
</code></pre>
            </li>
            <li>
                <p>Invocando al servicio web</p>
                <p>Removemos el listado de lugares "dummy" en el presentador <span>PlacesPresenter.java</span> y agregamos la invocacion
                al servicio web que devuelve el listado de lugares.</p>
                <pre><code class="language-java"><script type="prism-java">
package com.qacg.travelapp.presents;

import com.qacg.travelapp.api.ResourceGenerator;
import com.qacg.travelapp.models.Place;
import com.qacg.travelapp.views.IPlacesView;

import java.util.List;

import retrofit2.Call;
import retrofit2.Callback;
import retrofit2.Response;

public class PlacesPresenter {

    private IPlacesView view;

    public PlacesPresenter(IPlacesView view) {
        this.view = view;
    }

    public void loadPlaces() {

        Call<List<Place>> call = ResourceGenerator.getTravelResource().getAllPlaces();

        call.enqueue(new Callback<List<Place>>() {
            @Override
            public void onResponse(Call<List<Place>> call, Response<List<Place>> response) {
                if (response.isSuccessful()) {
                    if (response.body() != null && response.body().size() > 0) {
                        view.placesFound(response.body());
                    } else {
                        view.placesNotFound();
                    }
                } else {
                    view.connectionUnavailable();
                }
            }

            @Override
            public void onFailure(Call<List<Place>> call, Throwable t) {
                view.connectionUnavailable();
            }
        });
    }
}</script>
</code></pre>
            </li>
            <li>Ejecutar la aplicaci贸n </li>
        </ol>
    </div>
    <!-- end Retrofit places -->

</section>
<!-- footer -->
<footer>
    <div class="row wow fadeInUp" style="color: white;">
        <div class="twelve columns">
            <span>Quality & Knowledge on IT Services | 2018 | Ciudad de M茅xico</span>
            <ul class="social-links">
                <li><i class="fab fa-android"></i></li>
            </ul>
            Alejandro Salazar | Gerardo Epitacio | V铆ctor Hern谩ndez
        </div>
        <div id="go-top"><a class="smoothscroll" title="Back to Top" href="#home"><i class="fa fa-chevron-up"></i></a>
        </div>
    </div>
</footer>
<!-- footer end-->
<!-- java script -->
<script src="js/jquery-2.1.1.min.js"></script>
<script src="js/owl.carousel.min.js"></script>
<script src="js/waypoints.js"></script>
<script src="js/jquery.fittext.js"></script>
<script src="js/wow.min.js"></script>
<script src="js/jquery.nicescroll.min.js"></script>
<script src="js/prism.js"></script>
<script src="js/script.js"></script>
</body>
</html>
