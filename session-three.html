<!DOCTYPE html>
<!--[if lt IE 8 ]>
<html class="no-js ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]>
<html class="no-js ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 8)|!(IE)]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->

<head>
    <!--- basic page needs -->
    <meta charset="utf-8">
    <title>travelapp</title>
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- mobile specific metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <!-- css -->
    <link rel="stylesheet" href="css/default.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="stylesheet" href="css/animate.css">
    <link href="css/prism.css" rel="stylesheet">
    <!-- script -->
    <script src="js/modernizr.js"></script>
    <!-- favicons -->
    <link rel="shortcut icon" href="images/qacg.ico">
</head>

<body>
<!-- preloader -->
<div id="preloader">
    <div class="loader"></div>
</div>
<!--preloader end-->
<!-- header section -->
<header id="home">
    <nav id="m-nav">
        <a class="mobile-btn" href="#m-nav" title="Show navigation">Show navigation</a>
        <a class="mobile-btn" href="#" title="Hide navigation">Hide navigation</a>
        <ul id="nav" class="nav">
            <li><a href="index.html">Inicio</a></li>
            <li><a href="index.html#agenda">Temario</a></li>
            <li><a href="session-one.html">Sesión # 1</a></li>
            <li><a href="session-two.html">Sesión # 2</a></li>
            <li class="current"><a class="smoothscroll" href="#">Sesión # 3</a></li>
            <li><a href="session-four.html">Sesión # 4</a></li>
        </ul>
    </nav>
    <div class="row banner">
        <div class="banner-text">
            <h1 class="responsive-headline wow zoomIn">Integración de librerías</h1>
            <h3 class="wow fadeInUp">
                Sesión # 3
                <br>
                <br>
                Quality & Knowledge on IT Services
            </h3>
        </div>
    </div>
    <p class="scrolldown">
        <a class="smoothscroll" href="#about"><i class="fa fa-angle-double-down"></i></a>
    </p>
    <div class="header-overlay"></div>
</header>
<!-- header end -->
<!-- source code -->
<section id="topic">
    <div class="row bio-container">
        <div class="twelve columns bio-inner">
            <div class="four columns bio-left">
                <h2>Código Fuente</h2>
                <div class="pp-container">
                    <img class="picture wow zoomIn" src="images/source-code.png" alt="" style="background: white; padding: 24px;" />
                </div>
            </div>
            <div class="eight columns main-col wow fadeIn">
                <div class="arrow-left"></div>
                <p>
                <h3>
                    El código fuente del proyecto está disponible para su descarga a través de GitHub, dé click en el botón ver para explorar el repositorio del proyecto o dé click en Descargar para obtener directamente la version inicial o la última versión del proyecto Android Studio.
                </h3>
                </p>
                <div class="row">
                    <div class="six columns download">
                        <p align="center">
                            <a href="https://github.com/hercarr/travelapp" target="_blank" class="button"><i class="fab fa-github"></i>Ver en GitHub</a>
                            <a href="https://github.com/hercarr/travelapp/archive/session-three-start.zip" class="button" target="_blank"><i class="fa fa-download"></i>Versión inicial</a>
                            <a href="https://github.com/hercarr/travelapp/archive/master.zip" class="button" target="_blank"><i class="fa fa-download"></i>Versión final</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- source code end -->
<!-- section start -->
<section id="agenda">
    <!-- Start Main libraries -->
    <h1 class="section-title wow fadeInDown">Librerías Android</h1>
    <div class="row education">
        <p>A continuación se listan las librerías, que comunmente se utilizan durante el desarrollo de una aplicación
            Android.<br/>
            <span><a href="https://square.github.io/retrofit/">Retrofit</a> - </span>Se describe a si mismo de la siguiente manera,
            "Convierte una REST API a una interfaz Java", permite a travéz de anotaciones agregar un cuerpo en la petición,
            manipular los parametros de la URL y encabezados de la petición.<br/>
            <span><a href="https://github.com/google/gson">Gson</a> - </span>Se utiliza para la serialización y
            deserializacion de objetos Java a JSON y al revés ( de JSON a objetos Java).<br/>
            <span><a href="https://bumptech.github.io/glide/">Glide</a> - </span>Librería utilizada para descargar imágenes desde una URL.<br/>
            <span><a href="https://github.com/dlew/joda-time-android">JodaTime</a> - </span>Libreria que facilita enormemente el manejo de fechas como el parseo, formato, etc.<br/>
            <span><a href="https://github.com/ocpsoft/prettytime">Prettytime</a> - </span>Formato de fechas para Java con un formato de redes sociales.<br/>
            <span><a href="https://realm.io/docs/java/latest">Realm</a> - </span>Es un motor de bases de datos local utilizada en Android.<br/>
            <span><a href="https://developers.google.com/maps/documentation/android-sdk/intro">Google Maps</a> - </span>Integración con mapas de Google.<br/>
        </p>
    </div>
    <!-- start libraries types -->
    <h1 class="section-title wow fadeInDown">Tipos de librerías</h1>
    <div class="row education">
        <p>Podemos encontrar dos formas de agregar librerías a nuestra aplicación:<br/>
            <span>Localmente - </span>Los archivos de la libreria deben ser
            descargados para poder incluirlas en la aplicación.<br/>
            <span>Remotas - </span>Se agregan como una dependencia de Gradle para
            que al momento de realizar la sincronizacion, Gradle descargue las dependencias correspondientes en el proyecto.<br/>
        </p>
    </div>
    <!-- end libraries types -->
    <!-- start Retrofit authentication -->
    <div class="header-col content-header">
        <h2><span>Retrofit y Gson - Autenticación de usuarios</span></h2>
    </div>
    <div class="row education">
        <p>
            Vamos a integrar las librerías Retrofit y Gson para poder sustituir la autenticación "dummy" por
            una autenticación remota.<br />
            Para esto, será necesario consumir el siguiente servicio web: <br />
            <pre><code>https://travelapp-api.herokuapp.com/api/user/autenticate</code><br/></pre><br />
            El cual recibe y devuelve los siguientes datos en formato JSON a través de una peticion POST.
        </p>
        <pre><code class="language-javascript">
            <script type="prism-javascript">
// Cuerpo de la petición
{
  "username": "USER",
  "password": "PASSWORD"
}

// Respuesta
{
    "_id": "ID_USUARIO",
    "username": "USER",
    "password": "PASSWORD",
    "role": "ROLE"
}</script>
        </code>
        </pre>
        <br />
        <ol>
            <li>
                <span><p>Configurando Retrofit</p></span>
                <ol>
                    <li>
                        <p>Agregar las siguientes dependencias en el archivo Gradle de <span>la aplicación.</span></p>
                        <pre><code>implementation 'com.squareup.retrofit2:retrofit:2.5.0'</code></pre>
                        <pre><code>implementation 'com.squareup.retrofit2:converter-gson:2.5.0'</code><br/></pre><br />

                        <div class="content-picture-container">
                            <img class="content-picture wow zoomIn" src="images/session-three/gradle-dependencies.png" alt="new project" />
                        </div>
                    </li>
                    <li>
                        <p><span>Sincronizar el script gradle para descargar las dependencias agregadas.</span></p>
                    </li>
                    <li>
                        <p>
                            Crear el paquete <span>api</span> dentro del paquete <span>travelapp</span>.
                        </p>
                        <div class="content-picture-container">
                            <img class="content-picture wow zoomIn" src="images/session-three/api-package.png " alt="new project" />
                        </div>
                    </li>
                    <li>
                        <p>Archivo de servicios</p>
                        <p>Crear el archivo <span>ITravelResource.java</span> en el paquete <span>api</span>, esta será la interfaz donde se van a declarar los servicios web.</p>
                    </li>
                    <li>
                        <p>Inicializacion de Retrofit.</p>
                        <p>Crearemos el objeto <span>retrofit</span>, utilizando el patron singleton, para ello, creamos el archivo <span>ResourceGenerator.java</span> en el paquete <span>api</span> y agregar el contenido de configuración.</p>
                        <pre><code class="language-java">
                        <script type="prism-java">
package com.qacg.travelapp.api;

import retrofit2.Retrofit;
import retrofit2.converter.gson.GsonConverterFactory;

public class ResourceGenerator {

    /**
     * Url base de los servicios de la aplicación.
     */
    private static final String BASE_URL = "https://travelapp-api.herokuapp.com/api/";

    private static ITravelResource travelResource;

    private ResourceGenerator() {}

    static {
        setupRetrofit();
    }

    private static void setupRetrofit() {
        Retrofit retrofit = new Retrofit.Builder()
                .addConverterFactory(GsonConverterFactory.create())
                .baseUrl(BASE_URL).build();
        travelResource = retrofit.create(ITravelResource.class);
    }

    public static ITravelResource getTravelResource() {
        return travelResource;
    }
}</script>
                    </code>
                    </pre>
                    </li>
                </ol>
            </li>
            <li>
                <span><p>Integrando la autenticación de usuario</p></span>
                <ol>
                    <li>
                        <p>Configurando nuestro servicio web de autenticación</p>
                        <p>Agregamos el método <span>authenticateUser</span> en la interfaz <span>ITravelResource.java</span>, nuestro archivo quedará de la siguiente forma:</p>
                        <pre><code class="language-java">
                        <script type="prism-java">
package com.qacg.travelapp.api;

import com.qacg.travelapp.models.User;

import retrofit2.Call;
import retrofit2.http.Body;
import retrofit2.http.POST;

public interface ITravelResource {

    @POST("user/autenticate")
    Call<User> authenticateUser(@Body Object body);

}</script>
                    </code>
                    </pre>
                    </li>
                    <li>
                        <p>Permisos de acceso a internet</p>
                        <p>Agregamos el permiso para acceso a internet de la aplicación en el archivo <span>AndroidManifest.xml</span>:</p>

<pre><code class="language-java"><script type="prism-java"><uses-permission android:name="android.permission.INTERNET"/></script></code></pre>

                        <div class="content-picture-container">
                            <img class="content-picture wow zoomIn"  src="images/session-three/internet-permissions.png" alt="new project" />
                        </div>
                    </li>
                    <li>
                        <p>Preparando nuestro modelo de Peticion/Respuesta</p>
                        <p>Realizaremos unas pequeñas modificaciones a nuestra clase <span>User.java</span>, para poder
                            serializar y deserializar correctamente los datos que se envian y reciben del servidor.</p>
                        <ol>
                            <li><p>Agregamos una anotación para la serializacion de objetos para el campo <span>userName</span>, esto
                            nos permite recibir y enviar correctamente el nombre del campo <span>username</span> al momento de
                            serializar/deserializar la clase <span>User.java</span></p></li>
                            <li><p>Agregamos un constructor que recibe como argumentos el usuario y password.</p>
                                <pre><code class="language-java">
                        <script type="prism-java">
package com.qacg.travelapp.models;

import com.google.gson.annotations.SerializedName;

/**
 * Modelo que representa al usuario de la aplicación.
 */
public class User {

    @SerializedName("username")
    private String userName;
    private String password;

    public User(String userName, String password) {
        this.userName = userName;
        this.password = password;
    }

    public String getUserName() {
        return userName;
    }

    public void setUserName(String userName) {
        this.userName = userName;
    }

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }
}</script></code></pre>
                            </li>
                        </ol>
                    </li>

                    <li><p>Agregamos métodos para manejo de error(es) de red.</p>
                        <ol>
                            <li>
                                <p>Agregamos el método <span>connectionUnavailable</span> en el archivo <span>ILoginView.java</span>.</p>
                                <pre><code class="language-java">
                        <script type="prism-java">
package com.qacg.travelapp.views;

import com.qacg.travelapp.models.User;

/**
 * Vista que define el comportamiento de la vista.
 */
public interface ILoginView {
    void userFound(User user);

    void userNotFound();

    void emptyFields();

    void connectionUnavailable();
}</script></code></pre>
                            </li>
                            <li>
                                <p>Implementamos el método <span>connectionUnavailable</span> en la clase <span>LoginActivity.java</span>.</p>
                                <pre><code class="language-java">
                        <script type="prism-java">
@Override
public void connectionUnavailable() {
    final AlertDialog.Builder builder = new AlertDialog.Builder(this, R.style.LightDialogTheme);
    builder.setTitle(R.string.app_name);
    builder.setMessage(R.string.conection_unavailable);
    builder.setPositiveButton(R.string.accept_bnt, new DialogInterface.OnClickListener() {
        public void onClick(DialogInterface dialog, int id) {
            dialog.dismiss();
        }
    });
    AlertDialog dialog = builder.create();
    dialog.show();
}</script></code></pre>
                            </li>
                            <li><p>Agregamos el siguiente string en el archivo de strings.</p>
                                <p>strings.xml</p>
                                <pre><code class="language-java"><script type="prism-java">
<string name="conection_unavailable">Se presentaron algunos problemas al intentar conectarse con los servicios.</string>
</script></code></pre>

                                <p>strings.xml (en)</p>
                                <pre><code class="language-java"><script type="prism-java">
<string name="conection_unavailable">There were some problems when trying to connect with services.</string>
</script></code></pre>
                            </li>
                        </ol>
                    </li>

                    <li>
                        <p>Invocación del servicio web</p>
                        <p>Modificaremos a nuestro presentador para consumir el servicio web de autenticación.</p>
                        <pre><code class="language-java">
                        <script type="prism-java">
package com.qacg.travelapp.presents;

import com.qacg.travelapp.api.ResourceGenerator;
import com.qacg.travelapp.models.User;
import com.qacg.travelapp.views.ILoginView;

import retrofit2.Call;
import retrofit2.Callback;
import retrofit2.Response;

public class LoginPresenter {

    private ILoginView view;

    public LoginPresenter(ILoginView view) {
        this.view = view;
    }

    public void validateUser(final String username, String password) {
        if (username.length() == 0 || password.length() == 0) {
            view.emptyFields();
        } else {
            // Creamos nuestro objeto Call
            Call<User> call = ResourceGenerator.getTravelResource().authenticateUser(new User(username, password));
            // Realizamos la invocación al servicio web en una llamada asincrona.
            call.enqueue(new Callback<User>() {
                @Override
                public void onResponse(Call<User> call, Response<User> response) {
                    if (response.isSuccessful()) {
                        view.userFound(response.body());
                    } else {
                        controlErrors(response.code());
                    }
                }

                @Override
                public void onFailure(Call<User> call, Throwable t) {
                    if (!call.isCanceled()) {
                        view.connectionUnavailable();
                    }
                }
            });
        }
    }

    // Manejamos los codigos de error retornados por el servidor.
    private void controlErrors(int code) {
        if (code == 401) {
            view.userNotFound();
        } else {
            view.connectionUnavailable();
        }
    }
}</script></code></pre>
                    </li>
                </ol>
            </li>
            <li>
                <span><p>Agregando un loader</p></span>
                <p>Debido a que generalmente el consumo de servicios web se llevan a cabo de manera
                <span>asincrona</span>, Android provee ciertos componentes que permiten indicar al usuario
                que se esta realizando cierta tarea en segundo plano, estos componentes son comunmente conocidos como <span>Loaders</span>.</p>
                <p>Dentro de los loaders mas utilizados se encuentran el
                    <span><a href="https://developer.android.com/reference/android/app/ProgressDialog">ProgressDialog</a></span>
                    y el
                    <span><a href="https://developer.android.com/reference/android/widget/ProgressBar">ProgressBar</a></span>.</p>
                <p>Para efectos prácticos integraremos un <span>ProgressDialog</span> que será mostrado durante la llamada del servicio web de autenticación.</p>
                <ol>
                    <li>Agregamos los siguientes metodos en la interfaz <span>ILoginView.java</span></li>
                    <pre><code class="language-java">
                        <script type="prism-java">
    void showLoader();

    void hideLoader();
                        </script></code></pre>
                    <li>
                        <p>Agregamos el ProgressDialog en la actividad de login e implementamos los metodos
                            <span>showLoader</span> y <span>hideLoader</span>.</p>
                        <p>LoginActivity.java</p>
                        <pre><code class="language-java">
                        <script type="prism-java">
// Definimos una variable miembro.
private ProgressDialog progressbarDialog;

private void init() {
        presenter = new LoginPresenter(this);

        txtUsername = findViewById(R.id.txtUsername);
        txtPassword = findViewById(R.id.txtPassword);

        btnLogin = findViewById(R.id.btnLogin);
        btnLogin.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                presenter.validateUser(txtUsername.getText().toString(), txtPassword.getText().toString());
            }
        });

        // Inicializamos nuestro loader
        progressbarDialog = new ProgressDialog(this);
        progressbarDialog.setCancelable(false);
        progressbarDialog.setIndeterminate(true);
        progressbarDialog.setMessage(getString(R.string.starting_session));
    }


    @Override
    public void showLoader() {
        if (progressbarDialog != null && !progressbarDialog.isShowing()) {
            progressbarDialog.show();
        }
    }

    @Override
    public void hideLoader() {
        if (progressbarDialog != null && progressbarDialog.isShowing()) {
            progressbarDialog.hide();
        }
    }</script></code></pre>
                    </li>
                    <li>
                        <p>Agregamos los siguientes recursos en los archivos de string.</p>
                        <p>strings.xml</p>
                        <pre><code class="language-java"><script type="prism-java">
<string name="starting_session">Iniciando sesión</string>
</script></code></pre>

                        <p>strings.xml (en)</p>
                        <pre><code class="language-java"><script type="prism-java">
<string name="starting_session">Starting session</string>
</script></code></pre>
                    </li>
                    <li>
                        <p>Agregamos estilos</p>
                        <p>En el archivo <span>styles.xml</span> actualizamos el estilo <span>TransparentAppTheme</span></p>
                        <pre><code class="language-java">
                        <script type="prism-java">
<style name="TransparentAppTheme" parent="AppTheme">
        <item name="colorPrimary">@android:color/transparent</item>
        <item name="colorPrimaryDark">@color/statusBar</item>
        <item name="windowActionBarOverlay">true</item>
        <!-- Estilos a los dialogos -->
        <item name="android:alertDialogTheme">@style/LightDialogTheme</item>
        <item name="alertDialogTheme">@style/LightDialogTheme</item>
    </style></script></code></pre>
                    </li>
                    <li>
                        <p>Agregamos interaccion del loader desde el presentador</p>
                        <p>Actualizamos el metodo <span>validateUser</span> del archivo <span>LoginPresenter.java</span></p>
                        <pre><code class="language-java">
                        <script type="prism-java">
    public void validateUser(final String username, String password) {
        // Mostramos el loader antes de consumir el servicio web.
        view.showLoader();
        if (username.length() == 0 || password.length() == 0) {
            view.hideLoader();
            view.emptyFields();
        } else {
            Call<User> call = ResourceGenerator.getTravelResource().authenticateUser(new User(username, password));
            call.enqueue(new Callback<User>() {
                @Override
                public void onResponse(Call<User> call, Response<User> response) {
                    // Ocultamos el loader el recibir una respuesta desde el servidor.
                    view.hideLoader();
                    if (response.isSuccessful()) {
                        view.userFound(response.body());
                    } else {
                        controlErrors(response.code());
                    }
                }

                @Override
                public void onFailure(Call<User> call, Throwable t) {
                    // Ocultamos el loader si se presenta algun error.
                    view.hideLoader();
                    if (!call.isCanceled()) {
                        view.connectionUnavailable();
                    }
                }
            });
        }
    }</script></code></pre>
                    </li>
                    <li>
                        <p>Ejecutar la aplicación</p>
                        <p>Al introducir las credenciales de usuario y oprimir el botón <span>ENTRAR</span> se deberá mostrar un loader mientras se validan las credenciales del usuario.</p>
                        <p><span>Nota:</span> Si la peticion se realiza muy rapido es probable que el loader no se alcanze a visualizar y la aplicación mostrará en seguida la pantalla del listado de lugares.</p>
                        <div class="content-picture-container">
                            <img class="content-picture wow zoomIn" width="512px" src="images/session-three/iniciando-sesion.png" alt="new project" />
                        </div>
                    </li>
                </ol>
            </li>
        </ol>
    </div>
    <!-- end Retrofit authentication -->
    <!-- start Retrofit places -->
    <div class="header-col content-header">
        <h2><span>Retrofit - Listado de lugares</span></h2>
    </div>
    <div class="row education">
        <p>
            Integraremos el servicio web que devuelve el listado de lugares que son mostrados en la pantalla principal de la aplicación.
        Para ello se invocará el siguiente servicio web.
        </p>
        <pre><code>GET -> https://travelapp-api.herokuapp.com/api/place/all</code><br/></pre><br />
        <p>El cual retorna un modelo de respuesta como la siguiente.</p>
        <pre><code class="language-javascript"><script type="prism-javascript">
[
    {
        "postedBy": {
            "urlImageProfile": "https://randomuser.me/api/portraits/men/14.jpg",
            "nameProfile": "Enrique Johnson"
        },
        "placeId": "5bf79980a757cc00165dca6e",
        "createdAt": "2018-11-23T06:08:23.482Z",
        "updatedAt": "2018-11-23T06:08:23.482Z",
        "_id": "5bf79980a757cc00165dca6f",
        "isFavorite": "true",
        "urlImagePlace": "https://www.mercadoeeventos.com.br/wp-content/uploads/2017/12/shutterstock_528411958-1.jpg",
        "latitude": 20.6274,
        "longitude": -87.07987,
        "likes": 78,
        "namePlace": "Playa del carmen",
        "description": "Es una de las playas preferidas para vacacionar en la Riviera Maya, disfrutando su  fina y blanca arena bajo aguas verde-azules.",
        "totalComments": 14,
        "__v": 0
    },
    {
        "postedBy": {
            "urlImageProfile": "https://randomuser.me/api/portraits/women/67.jpg",
            "nameProfile": "Sherri Shaw"
        },
        "placeId": "5bf79980a757cc00165dca70",
        "createdAt": "2018-11-23T06:08:23.482Z",
        "updatedAt": "2018-11-23T06:08:23.482Z",
        "_id": "5bf79980a757cc00165dca71",
        "isFavorite": "false",
        "urlImagePlace": "https://www.mexicodesconocido.com.mx/wp-content/uploads/2016/12/nevado-de-toluca-parque-1600.jpg",
        "latitude": 19.17861,
        "longitude": -99.82111,
        "likes": 50,
        "namePlace": "Nevado de Toluca",
        "description": "Volcán mexicano ubicado en el Estado de México, entre los valles de Toluca y Tenango.",
        "totalComments": 30,
        "__v": 0
    }
]
        </script></code></pre>
        <ol>
            <li>
                <p>Configurando el servicio web</p>
                <p>Agregaremos la configuración del servicio web de lugares en el archivo <span>ITravelResource.java</span></p>
                <pre><code class="language-java"><script type="prism-java">
    @GET("place/all")
    Call<List<Place>> getAllPlaces();
</script>
</code></pre>
            </li>
            <li>
                <p>Modificando el modelo</p>
                <p>Realizaremos las siguientes modificaciones al modelo para asegurar la correcta serialización de datos.</p>
                <pre><code class="language-java"><script type="prism-java">
package com.qacg.travelapp.models;

import com.google.gson.annotations.SerializedName;

public class Place {

    @SerializedName("postedBy")
    private Profile profile;
    @SerializedName("createdAt")
    private String date;
    private String urlImagePlace;
    private boolean isFavorite;
    private double latitude, longitude;
    @SerializedName("likes")
    private int totalLikes;
    private String namePlace;
    private String description;
    private int totalComments;

    // getters & setters
    // ...
}</script>
</code></pre>
            </li>
            <li>
                <p>Declaracion del handler de error(es) de conexión</p>
                <p>Agregamos el medodo <span>void connectionUnavailable();</span> en el archivo <span>IPlacesView.java</span></p>
                <pre><code class="language-java"><script type="prism-java">
package com.qacg.travelapp.views;

import com.qacg.travelapp.models.Place;

import java.util.List;

public interface IPlacesView {

    void placesFound(List<Place> places);

    void placesNotFound();

    void connectionUnavailable();

}</script>
</code></pre>
            </li>

            <li>
                <p>Implementamos el handler de errores en el fragmento <span>PlacesFragment.java</span></p>
                <pre><code class="language-java"><script type="prism-java">
    @Override
    public void connectionUnavailable() {
        final AlertDialog.Builder builder = new AlertDialog.Builder(getActivity().getApplicationContext(), R.style.LightDialogTheme);
        builder.setTitle(R.string.app_name);
        builder.setMessage(R.string.conection_unavailable);
        builder.setPositiveButton(R.string.accept_bnt, new DialogInterface.OnClickListener() {
            public void onClick(DialogInterface dialog, int id) {
                dialog.dismiss();
            }
        });
        AlertDialog dialog = builder.create();
        dialog.show();
    }
</script>
</code></pre>
            </li>
            <li>
                <p>Invocando al servicio web</p>
                <p>Removemos el listado de lugares "dummy" en el presentador <span>PlacesPresenter.java</span> y agregamos la invocacion
                al servicio web que devuelve el listado de lugares.</p>
                <pre><code class="language-java"><script type="prism-java">
package com.qacg.travelapp.presents;

import com.qacg.travelapp.api.ResourceGenerator;
import com.qacg.travelapp.models.Place;
import com.qacg.travelapp.views.IPlacesView;

import java.util.List;

import retrofit2.Call;
import retrofit2.Callback;
import retrofit2.Response;

public class PlacesPresenter {

    private IPlacesView view;

    public PlacesPresenter(IPlacesView view) {
        this.view = view;
    }

    public void loadPlaces() {

        Call<List<Place>> call = ResourceGenerator.getTravelResource().getAllPlaces();

        call.enqueue(new Callback<List<Place>>() {
            @Override
            public void onResponse(Call<List<Place>> call, Response<List<Place>> response) {
                if (response.isSuccessful()) {
                    if (response.body() != null && response.body().size() > 0) {
                        view.placesFound(response.body());
                    } else {
                        view.placesNotFound();
                    }
                } else {
                    view.connectionUnavailable();
                }
            }

            @Override
            public void onFailure(Call<List<Place>> call, Throwable t) {
                view.connectionUnavailable();
            }
        });
    }
}</script>
</code></pre>
            </li>
            <li>
                <p>Ejecutar la aplicación</p>
                <p>Al ejecutar la aplicación, deberán tantos lugares como los devueltos por el servicio web.</p>
                <div class="content-picture-container">
                    <img class="content-picture wow zoomIn" width="512px" src="images/session-three/get-all-places.png" alt="new project" />
                </div>
            </li>
        </ol>
    </div>
    <!-- end Retrofit places -->
    <!-- start Glide -->
    <div class="header-col content-header">
        <h2><span>Glide - Carga de imágenes.</span></h2>
    </div>
    <div class="row education">
        <p>
            Integraremos la librería Glide para mostrar las imágenes a partir del URL devuelto por el servicio web.
        </p>

        <ol>
            <li>
                <p>Dependencias</p>
                <ol>
                    <li>
                        <p>Agregar la siguiente dependencia en el archivo Gradle de <span>la aplicación.</span></p>
                        <pre><code>implementation ("com.github.bumptech.glide:glide:4.8.0") {
        // Excluimos la libreria de soporte que provee la libreria
        // Ya que estamos implementando la version mas reciente.
        exclude group: "com.android.support"
    }</code></pre>
                    </li>
                    <li>
                        <p>Agregar las siguientes repositorios en el archivo Gradle <span>del proyecto</span></p>
                        <pre><code>
mavenCentral()
maven { url 'https://maven.google.com' }</code></pre>
                        <div class="content-picture-container">
                            <img class="content-picture wow zoomIn" width="512px" src="images/session-three/gradle-dependencies-project.png" alt="new project" />
                        </div>
                    </li>
                    <li>Sincronizamos para descargar las dependencias.</li>
                </ol>
            </li>

            <li>
                <p>Modificaciones al adaptador</p>
                <ol>
                    <li>
                        <p>Recibimos el contexto en el constructor.</p>
                    </li>
                    <li><p>Implementamos transformaciones y la carga de imágenes.</p></li>
                    <pre><code class="language-java">
                        <script type="prism-java">
package com.qacg.travelapp.adapters;

// imports...

public class PlaceAdapter extends RecyclerView.Adapter<PlaceAdapter.PlaceViewHolder> {

    private List<Place> places;
    private Context mContext;

    public PlaceAdapter(Context context) {
        mContext = context;
    }

    // Actualizamos el metodo para que solo muestre los elementos recibidos desde el servicio web.
    public void addList(List<Place> places) {
        this.places = places;
        notifyDataSetChanged();
    }

    @NonNull
    @Override
    public PlaceViewHolder onCreateViewHolder(@NonNull ViewGroup viewGroup, int i) {
        return new PlaceViewHolder(LayoutInflater.from(viewGroup.getContext()).inflate(R.layout.place_item, viewGroup, false));
    }

    @Override
    public void onBindViewHolder(@NonNull PlaceViewHolder placeViewHolder, int i) {
        placeViewHolder.dataBinding(places.get(i));
    }

    @Override
    public int getItemCount() {
        return places != null ? places.size() : 0;
    }

    class PlaceViewHolder extends RecyclerView.ViewHolder {

        private ImageView imageProfile;
        private TextView nameProfile;
        private TextView date;
        private TextView totalLikes;
        private TextView namePlace;
        private ImageView imagePlace;
        private TextView description;
        private TextView numberComments;


        public PlaceViewHolder(@NonNull View itemView) {
            super(itemView);
            imageProfile = itemView.findViewById(R.id.imageProfile);
            nameProfile = itemView.findViewById(R.id.nameProfile);
            date = itemView.findViewById(R.id.textDate);
            totalLikes = itemView.findViewById(R.id.totalLikes);
            imagePlace = itemView.findViewById(R.id.imagePlace);
            namePlace = itemView.findViewById(R.id.textTitlePlace);
            description = itemView.findViewById(R.id.textDescription);
            numberComments = itemView.findViewById(R.id.textNumberComments);
        }

        void dataBinding(Place place) {
            // Cargamos una imagen, a la que le hacemos una transformación (recorte la imagen a circular)
            Glide.with(mContext)
                    .load(place.getProfile().getUrlImageProfile())
                    .apply(RequestOptions.circleCropTransform())
                    .into(imageProfile);

            // Configuracion de opciones para transformar la imagen y establecer sus bordes redondeados.
            RequestOptions requestOptions = new RequestOptions();
            requestOptions = requestOptions.transforms(new CenterCrop(), new RoundedCorners(45));
            Glide.with(mContext)
                    .load(place.getUrlImagePlace())
                    .apply(requestOptions)
                    .into(imagePlace);

            nameProfile.setText(place.getProfile().getNameProfile());
            date.setText(place.getDate());
            totalLikes.setText(String.valueOf(place.getTotalLikes()));
            namePlace.setText(place.getNamePlace());
            description.setText(place.getDescription());
            numberComments.setText(String.valueOf(place.getTotalComments()));
        }
    }
}</script></code></pre>
                </ol>
            </li>
            <li>
                <p>Pasar el contexto al adaptador.</p>
                <p>En el archivo <span>PlacesFragment.java</span>, pasar el contexto al instanciar el adaptador.</p>
                <p>Nuestro método <span>init()</span> quedería de la siguiente forma.</p>
                <pre><code class="language-java">
                        <script type="prism-java">
    private void init(View view){
        places= view.findViewById(R.id.recyclerViewPlaces);
        places.setLayoutManager(new LinearLayoutManager(getContext()));
        places.setHasFixedSize(true);
        // Pasamos el contexto al adaptador.
        adapter = new PlaceAdapter(PlacesFragment.this.getContext());
        places.setAdapter(adapter);
        presenter = new PlacesPresenter(this);
        presenter.loadPlaces();
    }</script></code></pre>
            </li>
            <li>
                <p>Actualizamos nuestra vista.</p>
                <p>Realizamos las siguientes modificaciones al archivo <span>place_item.xml</span></p>
                <pre><code class="language-java">
                        <script type="prism-java">
<?xml version="1.0" encoding="utf-8"?>
<android.support.constraint.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:layout_margin="20dp">
    <!-- 1. Ajustamos los constraint para orientar los elementos en la parte superior del contenedor.-->
    <android.support.constraint.ConstraintLayout
        android:id="@+id/layoutHeader"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        app:layout_constraintTop_toTopOf="parent">
        <!-- 2. Establecemos un width de 40dp-->
        <!-- 3. La altura se ajusta automáticamente, manteniendo la relacion de aspecto-->
        <ImageView
            android:id="@+id/imageProfile"
            android:layout_width="40dp"
            android:layout_height="wrap_content"
            android:src="@drawable/profile"
            app:layout_constraintTop_toTopOf="parent"/>

        <TextView
            android:id="@+id/nameProfile"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_marginStart="15dp"
            android:fontFamily="sans-serif-medium"
            android:textSize="14sp"
            android:textStyle="normal"
            app:layout_constraintStart_toEndOf="@id/imageProfile"
            app:layout_constraintTop_toTopOf="parent"
            tools:text="Scarlett Johansson" />

        <TextView
            android:id="@+id/textDate"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_marginStart="15dp"
            android:fontFamily="sans-serif"
            android:textColor="#a8b6c8"
            android:textSize="12sp"
            android:textStyle="normal"
            app:layout_constraintStart_toEndOf="@id/imageProfile"
            app:layout_constraintTop_toBottomOf="@id/nameProfile"
            tools:text="hace 2 días" />

    </android.support.constraint.ConstraintLayout>
    <!-- 4. Establecemos un width al tamaño del contenedor padre-->
    <!-- 5. Establecemos un height de 240dp-->
    <!-- 6. Establecemos un tipo de escalado, que permite mantener la imagen recortada -->
    <!--    y ajustada al centro.-->
    <ImageView
        android:id="@+id/imagePlace"
        android:layout_width="match_parent"
        android:layout_height="240dp"
        android:layout_marginTop="10dp"
        android:scaleType="centerCrop"
        android:src="@drawable/image"
        app:layout_constraintTop_toBottomOf="@+id/layoutHeader" />

    <android.support.constraint.ConstraintLayout
        android:id="@+id/layoutPlaceOption"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_marginTop="15dp"
        app:layout_constraintTop_toBottomOf="@id/imagePlace">

        <ImageView
            android:id="@+id/imageOptionFavorite"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:paddingEnd="15dp"
            android:paddingTop="15dp"
            android:paddingBottom="15dp"
            android:src="@drawable/ic_favorite_border"
            app:layout_constraintStart_toStartOf="parent" />

        <ImageView
            android:id="@+id/imageOptionChat"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:padding="15dp"
            android:src="@drawable/ic_chat_bubble_outline"
            app:layout_constraintStart_toEndOf="@id/imageOptionFavorite" />

        <ImageView
            android:id="@+id/imageOptionNear"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:padding="15dp"
            android:src="@drawable/ic_near_me"
            app:layout_constraintStart_toEndOf="@id/imageOptionChat" />
    </android.support.constraint.ConstraintLayout>

    <View
        android:id="@+id/viewLineOne"
        android:layout_width="match_parent"
        android:layout_height="1dp"
        android:background="#4da8b6c8"
        app:layout_constraintTop_toBottomOf="@id/layoutPlaceOption" />

    <LinearLayout
        android:id="@+id/layoutLikes"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_marginTop="7dp"
        app:layout_constraintTop_toBottomOf="@id/viewLineOne">

        <ImageView
            android:id="@+id/imageLikes"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:padding="5dp"
            android:src="@drawable/ic_like" />

        <TextView
            android:id="@+id/totalLikes"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:fontFamily="sans-serif-light"
            android:padding="5dp"
            android:textColor="#323b45"
            android:textSize="14sp"
            android:textStyle="normal"
            tools:text="78 likes" />

    </LinearLayout>

    <TextView
        android:id="@+id/textTitlePlace"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:fontFamily="sans-serif"
        android:textColor="#323b45"
        android:textSize="14sp"
        android:textStyle="bold"
        app:layout_constraintTop_toBottomOf="@id/layoutLikes"
        tools:text="Playa del Carmen" />

    <TextView
        android:id="@+id/textDescription"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        app:layout_constraintTop_toBottomOf="@id/textTitlePlace"
        tools:text="Es una de las playas preferidas para vacacionar en la Riviera Maya, disfrutando su  fina y blanca arena bajo aguas verde-azules." />

    <TextView
        android:id="@+id/textNumberComments"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:padding="5dp"
        android:textColor="#a8b6c8"
        android:textSize="14sp"
        app:layout_constraintTop_toBottomOf="@id/textDescription"
        tools:text="14 comentarios" />
</android.support.constraint.ConstraintLayout></script></code></pre>
            </li>
            <li>
                <p>Ejecutar la aplicación</p>
                <p>Al ejecutar la aplicación, las fotos de perfil del usuario y la imagen del post deberían mostrarse correctamente.</p>
                <div class="content-picture-container">
                    <img class="content-picture wow zoomIn" width="512px" src="images/session-three/glide-integration.png" alt="new project" />
                </div>
            </li>
        </ol>
    </div>
    <!-- end Glide -->
    <!-- start JodaTime & Prettytime + swipe to refresh-->
    <div class="header-col content-header">
        <h2><span>JodaTime & Prettytime - Finalizando la integración.</span></h2>
    </div>
    <div class="row education">
        <p>
            Integraremos la librería JodaTime y Prettytime para darle formato a la fecha de creación del post.
        </p>
        <p>Realizaremos también ajustes menores al item del listado.</p>
        <ol>
            <li>
                <p>Dependencias</p>
                <ol>
                    <li>
                        <p>Agregar las siguientes dependencias en el archivo Gradle de <span>la aplicación.</span></p>
                        <pre><code>
implementation 'net.danlew:android.joda:2.10.1'
implementation 'org.ocpsoft.prettytime:prettytime:4.0.1.Final'</code></pre>
                    </li>
                    <li>
                        <p>Sincronizar los scripts Gradle del proyecto.</p>
                    </li>
                </ol>
            </li>
            <li>
                <p>Agregamos los siguientes recursos en el archivo de strings.</p>
                <p>strings.xml</p>
                <pre><code class="language-java"><script type="prism-java">
<string name="comments_placeholder">%1s comentarios</string>
<string name="likes_placeholder">%1s me gusta</string>
</script></code></pre>
                <p>strings.xml (en)</p>
                <pre><code class="language-java"><script type="prism-java">
<string name="comments_placeholder">%1s comments</string>
<string name="likes_placeholder">%1s likes</string>
</script></code></pre>
            </li>
            <li>
                <p>Realizamos las siguientes modificaciones al archivo <span>PlaceAdapter.java</span></p>
                <pre><code class="language-java">
                        <script type="prism-java">
    // Clase: PlaceAdapter
    // Agregamos un metodo para formatear la fecha
    private String parseToElapsedTime(String stringDatetime) {
        DateTimeFormatter formatter = DateTimeFormat.forPattern("yyyy-MM-dd'T'HH:mm:ss.SSSZ");
        return new PrettyTime().format( DateTime.parse(stringDatetime, formatter).toDate() );
    }

    // Clase: PlaceViewHolder
    // Actualizamos el metodo dataBinding()
    void dataBinding(Place place) {
            Glide.with(mContext)
                    .load(place.getProfile().getUrlImageProfile())
                    .apply(RequestOptions.circleCropTransform())
                    .into(imageProfile);
            RequestOptions requestOptions = new RequestOptions();
            requestOptions = requestOptions.transforms(new CenterCrop(), new RoundedCorners(45));
            Glide.with(mContext)
                    .load(place.getUrlImagePlace())
                    .apply(requestOptions)
                    .into(imagePlace);
            nameProfile.setText(place.getProfile().getNameProfile());
            date.setText(parseToElapsedTime(place.getDate()));
            totalLikes.setText(String.valueOf(place.getTotalLikes()));
            namePlace.setText(place.getNamePlace());
            description.setText(place.getDescription());
            numberComments.setText(mContext.getResources().getString(R.string.comments_placeholder, String.valueOf(place.getTotalComments())));
    }</script></code></pre>
            </li>
            <li>
                <p>Ejecutar la aplicación</p>
                <p>Al ejecutar la aplicación, se deben de mostrar los siguientes cambios:</p>
                <ol>
                    <li>La fecha de publicación formateada adecuadamente</li>
                    <li>Se agrega el string <span>comentarios</span> adelante de la cantidad de comentarios</li>
                    <li>Se agrega el string <span>me gusta</span> adelante de la cantidad de likes</li>
                </ol>
                <div class="content-picture-container">
                    <img class="content-picture wow zoomIn" width="512px" src="images/session-three/timeformating-extras.png" alt="new project" />
                </div>
            </li>

            <li>
                <p>Agregando el elemento pull to refresh.</p>
                <ol>
                    <p>
                        El elemento pull to refresh, nos permite escuchar en nuestra actividad o fragmento cuando el usuario
                        realiza un gesto de arrastre hacia abajo (pull) dentro de un listado <span>ListView o RecyclerView</span>.
                    </p>
                    <li>
                        <p>Actualizamos nuestro archivo <span>fragment_places.xml</span> con el siguiente contenido.</p>
                        <pre><code class="language-java">
                        <script type="prism-java">
<?xml version="1.0" encoding="utf-8"?>
<FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    tools:context=".fragments.PlacesFragment">
    <android.support.v4.widget.SwipeRefreshLayout
        xmlns:android="http://schemas.android.com/apk/res/android"
        android:id="@+id/swiperefresh"
        android:layout_width="match_parent"
        android:layout_height="match_parent">
        <android.support.v7.widget.RecyclerView
            android:id="@+id/recyclerViewPlaces"
            android:layout_width="match_parent"
            android:layout_height="match_parent" />
    </android.support.v4.widget.SwipeRefreshLayout>
</FrameLayout></script></code></pre>
                    </li>
                    <li>
                        <p>Actualizamos el método <span>init()</span> y el metodo <span>placesFound()</span> del fragmento <span>PlacesFragment.java</span></p>
                        <pre><code class="language-java">
                        <script type="prism-java">
    private void init(View view){
        places= view.findViewById(R.id.recyclerViewPlaces);
        swipeRefreshLayout = view.findViewById(R.id.swiperefresh);
        swipeRefreshLayout.setOnRefreshListener(
                new SwipeRefreshLayout.OnRefreshListener() {
                    @Override
                    public void onRefresh() {
                        presenter.loadPlaces();
                    }
                }
        );
        places.setLayoutManager(new LinearLayoutManager(getContext()));
        places.setHasFixedSize(true);
        adapter= new PlaceAdapter(PlacesFragment.this.getContext());
        places.setAdapter(adapter);
        presenter = new PlacesPresenter(this);

        swipeRefreshLayout.setRefreshing(true);
        presenter.loadPlaces();
    }

    @Override
    public void placesFound(List<Place> places) {
        adapter.addList(places);
        if (swipeRefreshLayout != null && swipeRefreshLayout.isRefreshing()) {
            swipeRefreshLayout.setRefreshing(false);
        }
    }</script></code></pre>
                    </li>
                    <li>
                        <p>Ejecutar la aplicación</p>
                        <p>Al ejecutar la aplicación, esta permite actualizar el listado de lugares cuando el usuario
                            realiza el gesto Swipe.</p>
                        <div class="content-picture-container">
                            <img class="content-picture wow zoomIn" width="512px" src="images/session-three/swipe.gif" alt="new project" />
                        </div>
                    </li>
                </ol>
            </li>
        </ol>
    </div>
</section>
<!-- footer -->
<footer>
    <div class="row wow fadeInUp" style="color: white;">
        <div class="twelve columns">
            <span>Quality & Knowledge on IT Services | 2018 | Ciudad de México</span>
            <ul class="social-links">
                <li><i class="fab fa-android"></i></li>
            </ul>
            Alejandro Salazar | Gerardo Epitacio | Víctor Hernández
        </div>
        <div id="go-top"><a class="smoothscroll" title="Back to Top" href="#home"><i class="fa fa-chevron-up"></i></a>
        </div>
    </div>
</footer>
<!-- footer end-->
<!-- java script -->
<script src="js/jquery-2.1.1.min.js"></script>
<script src="js/owl.carousel.min.js"></script>
<script src="js/waypoints.js"></script>
<script src="js/jquery.fittext.js"></script>
<script src="js/wow.min.js"></script>
<script src="js/jquery.nicescroll.min.js"></script>
<script src="js/prism.js"></script>
<script src="js/script.js"></script>
</body>
</html>
